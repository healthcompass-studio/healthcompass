<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê±´ê°•í•œ ë‚˜ì¹¨ë°˜</title>
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background-color: #f7f9fc;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    header {
      background-color: #4cb7a5;
      color: white;
      padding: 20px;
      font-size: 1.8em;
      font-weight: bold;
    }
    .search-section {
      margin: 20px auto;
      padding: 10px;
    }
    input, select, button {
      padding: 10px;
      margin: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #4cb7a5;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #3a9888;
    }
    #map {
      width: 90%;
      height: 400px;
      margin: 20px auto;
      border-radius: 10px;
    }
    #result {
      width: 80%;
      margin: 20px auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      text-align: left;
    }
  </style>
</head>
<body>

  <header>ğŸ©º ê±´ê°•í•œ ë‚˜ì¹¨ë°˜</header>

  <section class="search-section">
    <h3>ë‹¹ì‹ ì—ê²Œ ë§ëŠ” ë³µì§€í˜œíƒì„ ì°¾ì•„ë³´ì„¸ìš”</h3>
    <select id="group">
      <option value="">ëŒ€ìƒ ì„ íƒ</option>
      <option value="elderly">ë…¸ì¸</option>
      <option value="lowIncome">ê¸°ì´ˆìˆ˜ê¸‰ì</option>
      <option value="disabled">ì¥ì• ì¸</option>
    </select>
    <input type="text" id="keyword" placeholder="ì˜ˆ: ê±´ê°•ê²€ì§„, ë³‘ì›ë¹„ ì§€ì› ë“±">
    <button onclick="searchBenefit()">ê²€ìƒ‰</button>
  </section>

  <div id="result"></div>
  <div id="map"></div>

  <!-- âœ… ì¹´ì¹´ì˜¤ë§µ API ë¶ˆëŸ¬ì˜¤ê¸° -->
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=cd4f1d49b9dbbeb55accd0737ad65b38&libraries=services"></script>

  <script>
    // -------------------------------
    // ğŸ—ºï¸ ì§€ë„ ì´ˆê¸°í™”
    // -------------------------------
    const mapContainer = document.getElementById('map');
    const mapOption = {
      center: new kakao.maps.LatLng(37.5665, 126.9780), // ê¸°ë³¸ ì¤‘ì‹¬ (ì„œìš¸ì‹œì²­)
      level: 5
    };
    const map = new kakao.maps.Map(mapContainer, mapOption);

    // -------------------------------
    // ğŸ“ ë‚´ ìœ„ì¹˜ ê¸°ë°˜ìœ¼ë¡œ ì§€ë„ ì¤‘ì‹¬ ì´ë™ + ë³‘ì› í‘œì‹œ
    // -------------------------------
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        const locPosition = new kakao.maps.LatLng(lat, lon);

        // ì§€ë„ ì¤‘ì‹¬ ì´ë™
        map.setCenter(locPosition);

        // ë‚´ ìœ„ì¹˜ ë§ˆì»¤ í‘œì‹œ
        const myMarker = new kakao.maps.Marker({
          position: locPosition
        });
        myMarker.setMap(map);

        // âœ… ë³‘ì› ê²€ìƒ‰ ë° í‘œì‹œ
        const ps = new kakao.maps.services.Places();
        ps.keywordSearch('ë³‘ì›', function (data, status) {
          if (status === kakao.maps.services.Status.OK) {
            for (let i = 0; i < data.length; i++) {
              displayMarker(data[i]);
            }
          }
        }, {
          location: locPosition, // ë‚´ ìœ„ì¹˜ ê¸°ì¤€
          radius: 3000           // ë°˜ê²½ 3km
        });

        // âœ… ë³‘ì› ë§ˆì»¤ í‘œì‹œ í•¨ìˆ˜
        function displayMarker(place) {
          const marker = new kakao.maps.Marker({
            map: map,
            position: new kakao.maps.LatLng(place.y, place.x)
          });

          const infowindow = new kakao.maps.InfoWindow({
            content: `<div style="padding:8px; font-size:13px;">
                        <b>${place.place_name}</b><br>
                        ${place.road_address_name || place.address_name}<br>
                        ${place.phone ? `â˜ ${place.phone}` : ''}
                      </div>`
          });

          kakao.maps.event.addListener(marker, 'click', function() {
            infowindow.open(map, marker);
          });

          // ë³‘ì› ëª©ë¡ì„ ì§€ë„ ì•„ë˜ì— ì¶”ê°€ (ì„ íƒ ê¸°ëŠ¥)
          const resultDiv = document.getElementById('result');
          resultDiv.innerHTML += `<p>ğŸ¥ ${place.place_name} - ${place.road_address_name || place.address_name}</p>`;
        }

      }, function() {
        alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤ ğŸ˜¥");
      });
    } else {
      alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
    }

    // -------------------------------
    // ğŸ’¡ ë³µì§€í˜œíƒ ê²€ìƒ‰ ê¸°ëŠ¥
    // -------------------------------
    function searchBenefit() {
      const group = document.getElementById('group').value;
      const keyword = document.getElementById('keyword').value;
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = ""; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

      let message = "";

      if (group === "elderly") {
        message += "<h3>ë…¸ì¸ ë³µì§€ í˜œíƒ</h3>";
        message += "<ul><li>ë¬´ë£Œ ë…ê° ì˜ˆë°©ì ‘ì¢…</li><li>ê±´ê°•ê²€ì§„ ì§€ì›</li><li>ë…¸ì¸ë³µì§€ê´€ ë¬´ë£Œ ìš´ë™ í”„ë¡œê·¸ë¨</li></ul>";
      } else if (group === "lowIncome") {
        message += "<h3>ê¸°ì´ˆìˆ˜ê¸‰ì í˜œíƒ</h3>";
        message += "<ul><li>ë³‘ì› ì§„ë£Œë¹„ 90% ì§€ì›</li><li>ì˜ë£Œê¸‰ì—¬ 1ì¢…/2ì¢… í˜œíƒ</li><li>ë³´ê±´ì†Œ ë¬´ë£Œ ì§„ë£Œ</li></ul>";
      } else if (group === "disabled") {
        message += "<h3>ì¥ì• ì¸ ë³µì§€ í˜œíƒ</h3>";
        message += "<ul><li>ì¬í™œì¹˜ë£Œë¹„ ì§€ì›</li><li>ì¥ì• ì¸ ì „ìš© ë³‘ì›ë¹„ ê°ë©´</li></ul>";
      } else {
        message += "<p>ëŒ€ìƒê³¼ í‚¤ì›Œë“œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</p>";
      }

      if (keyword) {
        message += `<p>ê²€ìƒ‰ í‚¤ì›Œë“œ: <strong>${keyword}</strong></p>`;
      }

      resultDiv.innerHTML = message;
    }
  </script>

</body>
</html>